# Capability: Progression Practice（和弦走向练习）

## ADDED Requirements

### Requirement: 常见和弦走向库

系统 SHALL 提供常见的和弦走向库，用户可以浏览、筛选并选择走向开始练习。

#### Scenario: 浏览走向列表

- **WHEN** 用户进入“和弦走向练习”页面
- **THEN** 系统应展示走向列表
- **AND** 每个走向应至少包含名称与罗马数字序列（例如 I–V–vi–IV）

#### Scenario: 按标签筛选

- **WHEN** 用户选择标签 “pop”
- **THEN** 系统应仅显示包含该标签的走向

#### Scenario: 走向最低覆盖

- **WHEN** 系统提供内置走向库
- **THEN** 至少应包含以下走向：
  - I–V–vi–IV（流行常用）
  - I–vi–IV–V（50s progression）
  - ii–V–I（爵士常用）
  - 12 小节布鲁斯（I/IV/V）
  - Andalusian cadence（i–VII–VI–V）

### Requirement: 走向试听（试听一整个走向）

系统 SHALL 允许用户对选中的走向进行试听，并能在试听中感知当前和弦推进。

#### Scenario: 点击试听

- **WHEN** 用户在走向列表中点击“试听”
- **THEN** 系统应按当前设置的 BPM 与每和弦拍数依次播放走向中的各个和弦
- **AND** UI 应高亮当前正在播放的和弦

#### Scenario: 试听循环

- **WHEN** 用户开启“循环”并试听走向
- **THEN** 播放到最后一个和弦后应回到第一个和弦继续播放

### Requirement: 调性下的走向生成（罗马数字 → 具体和弦）

系统 SHALL 支持用户选择调性（Key），并将走向的罗马数字序列转换为具体和弦序列用于展示与播放。

#### Scenario: 大调生成示例（I–V–vi–IV）

- **WHEN** 用户选择调性为 C 且走向为 I–V–vi–IV
- **THEN** 系统应生成并展示和弦序列：C、G、Am、F

#### Scenario: 大调生成示例（换调）

- **WHEN** 用户选择调性为 G 且走向为 I–V–vi–IV
- **THEN** 系统应生成并展示和弦序列：G、D、Em、C

#### Scenario: 小调生成示例（i–VII–VI–V）

- **WHEN** 用户选择调性为 A minor 且走向为 i–VII–VI–V
- **THEN** 系统应生成并展示和弦序列：Am、G、F、E

### Requirement: 动态走向练习（节拍推进）

系统 SHALL 提供动态练习模式：在节拍下按设定参数自动推进当前和弦，支持开始/暂停/停止与手动跳转。

#### Scenario: 开始练习并推进

- **WHEN** 用户点击“开始练习”
- **THEN** 系统应从第一个和弦开始
- **AND** 每经过 `beatsPerChord` 拍后自动切换到下一个和弦
- **AND** UI 应同步更新当前和弦高亮

#### Scenario: 暂停与继续

- **WHEN** 用户在练习过程中点击“暂停”
- **THEN** 系统应停止推进并保持当前和弦不变
- **WHEN** 用户点击“继续”
- **THEN** 系统应从当前和弦继续推进

#### Scenario: 上一/下一和弦

- **WHEN** 用户点击“下一和弦”
- **THEN** 系统应立即切换到下一个和弦并更新高亮
- **WHEN** 用户点击“上一和弦”
- **THEN** 系统应立即回到上一个和弦并更新高亮

### Requirement: 练习模式 - 跟随模式（Follow）

系统 SHALL 提供跟随模式：同时显示当前和弦与下一和弦，帮助用户跟随练习。

#### Scenario: 显示当前与下一和弦

- **WHEN** 用户选择练习模式为“跟随”
- **THEN** 系统应显示当前和弦与下一和弦
- **AND** 下一和弦应在切换前可见

### Requirement: 练习模式 - 记忆模式（Memory）

系统 SHALL 提供记忆模式：默认隐藏下一和弦（或隐藏全部走向），用户可主动揭示，并记录基本练习数据。

#### Scenario: 隐藏下一和弦

- **WHEN** 用户选择练习模式为“记忆”
- **THEN** 系统应默认隐藏下一和弦信息
- **AND** 系统应提供“揭示下一和弦”操作

#### Scenario: 记录揭示次数

- **WHEN** 用户在一次练习会话中多次点击“揭示下一和弦”
- **THEN** 系统应统计并显示本次会话的揭示次数

### Requirement: 练习模式 - 听辨模式（Ear）

系统 SHALL 提供听辨模式：系统播放目标和弦，用户通过选择题形式作答，并获得正确性反馈。

#### Scenario: 选择题作答

- **WHEN** 系统播放“下一和弦”的目标音频
- **THEN** 系统应展示 4 个候选答案（其中 1 个为正确和弦）
- **WHEN** 用户选择一个候选答案
- **THEN** 系统应立即反馈正确/错误

#### Scenario: 正确率统计

- **WHEN** 用户完成至少 10 次听辨作答
- **THEN** 系统应显示本次会话的正确率（正确次数/总次数）

### Requirement: 练习设置持久化

系统 SHALL 将用户的走向练习设置保存到 localStorage，并在下次打开页面时恢复。

#### Scenario: 保存最后一次设置

- **WHEN** 用户将 BPM 设置为 140、每和弦拍数设置为 2、模式设置为“跟随”
- **THEN** 系统应保存这些设置到 localStorage

#### Scenario: 恢复最后一次设置

- **WHEN** 用户重新打开“和弦走向练习”页面
- **THEN** 系统应恢复为上次保存的走向与练习设置

### Requirement: 键盘与无障碍支持

系统 SHALL 提供基础键盘操作与无障碍属性，确保练习在桌面端高效可用。

#### Scenario: 键盘快捷键

- **WHEN** 用户按下空格键
- **THEN** 系统应切换播放/暂停状态
- **WHEN** 用户按下左/右方向键
- **THEN** 系统应切换到上一/下一和弦

