## Context

本项目是一个以“吉他和弦练习”为核心的 Web 应用，已具备单和弦试听（扫弦/分解）与节拍器能力。新增“和弦走向练习”需要把现有能力组合成一个**可循环、可调速、可交互**的训练流程，并尽量复用现有音频引擎与和弦数据源。

## Goals / Non-Goals

- Goals:
  - 以走向为单位组织练习：选走向 → 选调性 → 设定 BPM/每和弦拍数 → 动态推进练习
  - 提供“常见走向库 + 试听 + 多练习模式”以增强交互性
  - 与现有和弦指法展示/试听能力一致：每个和弦仍可显示指法与多把位
  - 保持实现最小化：不引入复杂后端与账号体系
- Non-Goals (MVP):
  - 不做实时拾音与演奏正确性判定
  - 不做用户账号/云端同步

## Decisions

- Decision: 走向数据用“罗马数字序列 + 元数据”表示
  - Why: 罗马数字与调性解耦，便于在任意调性下生成具体和弦，同时可在 UI 中展示“理论层”（I, V, vi, IV）与“实际和弦名”（C, G, Am, F）。

- Decision: 走向播放采用“节拍驱动的事件序列”而不是“点击即播放单和弦”
  - Why: 动态练习的核心是时间轴推进（每 N 拍切换和弦、循环、暂停/继续、count-in），需要抽象为可调度的事件。

- Decision: 练习模式作为同一走向会话的不同视图/规则
  - Why: 跟随/记忆/听辨共用相同的走向、调性与时间推进，仅 UI 与交互规则不同，便于复用状态机与音频调度。

## Data Model (Draft)

### Progression（走向定义）

- `id`: string
- `name`: string（中文名/常用别名）
- `romanNumerals`: string[]（如 `["I", "V", "vi", "IV"]`）
- `tags`: string[]（pop / rock / blues / jazz / folk 等）
- `timeSignature`: string（MVP 可默认 4/4）
- `defaultBpm`: number
- `notes`: string（可选，风格说明/代表歌曲提示）

### Session（练习会话）

- `progressionId`
- `key`: string（如 C, G, A, Bb）
- `mode`: follow | memory | ear
- `bpm`
- `beatsPerChord`: number（每个和弦持续的拍数，如 4 拍/2 拍）
- `playStyle`: strum | arpeggio
- `loop`: boolean
- `currentIndex`

持久化建议：localStorage 保存最后一次会话设置（不保存大量历史记录，MVP 仅保存“最后一次”）。

## UX Flow (Draft)

1. 进入“和弦走向练习”
2. 选择一个常见走向（可搜索/按风格筛选）并试听
3. 选择调性（Key）与练习参数（BPM、每和弦拍数、播放方式、是否循环、count-in）
4. 开始练习：
   - 屏幕聚焦当前和弦（大字 + 指法图）
   - 显示下一和弦与进度条/拍点
   - 支持键盘/触控的暂停、跳转、重置
5. 结束或中断练习：显示简要统计（模式相关）

## Alternatives considered

- 直接提供“走向列表 + 点击逐个和弦试听”
  - Pros: 实现非常快
  - Cons: 无法满足“动态、交互性很强”的练习诉求（缺少节拍推进、循环、模式化训练）

- 引入麦克风拾音做“演奏判定”
  - Pros: 反馈更强
  - Cons: 实现复杂、误判风险大、浏览器权限与环境噪声问题多，不适合作为 MVP

## Risks / Trade-offs

- 音频调度与 UI 同步：
  - 风险：节拍漂移/高频渲染导致 UI 卡顿
  - 缓解：把“调度”与“渲染”解耦；使用稳定的调度时钟（已有 `tone` 依赖可作为候选）

- 和弦生成的准确性：
  - 风险：罗马数字到具体和弦类型映射在大小调、借用和弦中有复杂情况
  - 缓解：MVP 优先覆盖常见大调/自然小调走向；复杂走向后续扩展

## Migration Plan

纯新增，不需要迁移。若需要扩展 `useAudio` API，优先通过新增方法保持向后兼容。

## Open Questions (记录但不阻塞提案)

- MVP 是否需要“自定义走向输入”？（本提案先不做）
- 走向试听是否默认使用同一把位/同一音区，还是跟随当前用户选择的 Variant？（实现阶段再根据现有数据结构选择最小改动方案）

