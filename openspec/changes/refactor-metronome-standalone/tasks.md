# Implementation Tasks

## 1. 增强 useMetronome Hook

- [x] 1.1 添加拍号状态（timeSignature: '4/4' | '3/4' | '6/8' | '2/4'）
- [x] 1.2 添加音量状态（volume: 0-100，默认 70）
- [x] 1.3 实现拍号配置逻辑（强拍位置、总拍数）
- [x] 1.4 修改 playBeat 函数支持动态音量（通过 GainNode 调节）
- [x] 1.5 修改调度器逻辑适配不同拍号的拍数
- [x] 1.6 扩展 localStorage 持久化（保存拍号和音量）
- [x] 1.7 添加 updateTimeSignature 和 updateVolume 方法
- [x] 1.8 更新 6/8 拍的强拍逻辑（第 1、4 拍为强拍）

## 2. 重构 Metronome 组件

- [x] 2.1 调整布局为全屏/大屏幕适配（更大的字体和控件）
- [x] 2.2 添加拍号选择器（Select 或 ToggleGroup）
- [x] 2.3 添加音量控制滑块
- [x] 2.4 改进视觉节拍指示器（动态显示 2-6 个圆点）
- [x] 2.5 放大 BPM 显示（适合远距离查看）
- [x] 2.6 优化按钮和控件大小（触控友好）
- [x] 2.7 添加拍号说明文字（如"3/4 拍 - 华尔兹"）

## 3. 创建独立节拍器界面

- [x] 3.1 创建 MetronomeDialog 组件（使用 Shadcn Sheet）
- [x] 3.2 配置 Sheet 为全屏或侧边抽屉模式
- [x] 3.3 集成重构后的 Metronome 组件
- [x] 3.4 添加关闭按钮和快捷键（ESC 键）
- [x] 3.5 确保对话框打开时不影响背景页面功能

## 4. 集成到主页面

- [x] 4.1 在 page.tsx 添加节拍器触发按钮（建议在顶部操作栏）
- [x] 4.2 管理 MetronomeDialog 的打开/关闭状态
- [x] 4.3 添加按钮图标（如 Metronome 或 Timer 图标）
- [x] 4.4 确保移动端和桌面端按钮位置合理

## 5. 移除旧的嵌入式节拍器

- [x] 5.1 从 PlaybackControls.tsx 中移除 `<Metronome />` 组件引用
- [x] 5.2 移除相关的 import 语句
- [x] 5.3 移除节拍器分隔线（`<Separator />`）
- [x] 5.4 调整 PlaybackControls 布局（移除节拍器后可能需要调整间距）

## 6. 测试与验证

- [x] 6.1 测试所有拍号切换（4/4, 3/4, 6/8, 2/4）
- [x] 6.2 验证强拍/弱拍音效区分在各拍号下正确
- [x] 6.3 测试音量控制（0-100% 范围）
- [x] 6.4 验证 BPM 实时调节在所有拍号下正常工作
- [x] 6.5 测试状态持久化（刷新页面后恢复 BPM、拍号、音量）
- [x] 6.6 测试对话框打开/关闭流畅性
- [x] 6.7 测试键盘快捷键（空格键、ESC 键）
- [x] 6.8 验证移动端触控体验
- [x] 6.9 测试与和弦播放功能的兼容性（同时使用不冲突）
- [x] 6.10 验证资源清理（关闭对话框时停止节拍器）

## 7. UI/UX 优化

- [x] 7.1 添加拍号切换动画（视觉指示器圆点数量变化）
- [x] 7.2 优化全屏模式下的视觉层次
- [x] 7.3 确保暗色模式下节拍器界面美观
- [x] 7.4 添加音量静音快捷按钮（可选）
- [x] 7.5 添加使用提示（首次打开时显示简短说明）

## Dependencies

- 任务 3 依赖任务 2 完成（组件重构）
- 任务 4 依赖任务 3 完成（对话框创建）
- 任务 5 可在任务 4 完成后并行进行
- 任务 6 依赖任务 1-5 全部完成

## Validation Criteria

- ✅ 节拍器可以通过主页面按钮打开
- ✅ 对话框以全屏/抽屉模式显示
- ✅ 支持 4 种拍号切换，强拍位置正确
- ✅ 音量控制生效，范围 0-100%
- ✅ BPM 调节范围 40-240，实时响应
- ✅ 视觉指示器根据拍号动态显示正确数量的圆点
- ✅ 状态持久化（BPM、拍号、音量）
- ✅ PlaybackControls 中不再包含节拍器
- ✅ 移动端和桌面端体验良好
- ✅ 无内存泄漏，资源正确清理
