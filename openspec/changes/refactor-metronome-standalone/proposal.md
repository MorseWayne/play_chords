# Change: 重构节拍器为独立全屏界面

## Why

当前节拍器嵌入在 `PlaybackControls` 组件中，与和弦播放控制混在一起，存在以下问题：

- **空间受限**：无法提供更多功能（多拍号、音量控制等）
- **用户体验割裂**：节拍器是独立的练习工具，不应与和弦选择器绑定在一起
- **功能局限**：只支持 4/4 拍，无法满足多样化的节奏练习需求
- **视觉干扰**：和弦练习时节拍器控件占用空间，影响核心功能展示

将节拍器重构为独立的全屏界面（对话框模式），可以：

- 提供更大的操作空间和更清晰的视觉反馈
- 支持多拍号切换（4/4、3/4、6/8、2/4）
- 添加音量控制功能
- 让用户可以专注于节拍训练，或在需要时快速呼出

## What Changes

### 核心变更

1. **移除嵌入式节拍器**
   - 从 `PlaybackControls.tsx` 中完全移除 `<Metronome />` 组件
   - 移除相关的分隔线和布局代码

2. **创建独立节拍器界面**
   - 使用 Shadcn Dialog 或 Sheet 组件实现全屏/抽屉模式
   - 在主页面添加触发按钮（顶部操作栏或悬浮按钮）
   - 节拍器打开时占据主要视觉空间，提供沉浸式体验

3. **增强节拍器功能**
   - **多拍号支持**：用户可选择 4/4、3/4、6/8、2/4 拍号
   - **音量控制**：独立的音量滑块（0-100%）
   - **重构 `useMetronome` hook**：支持动态拍号和音量参数
   - **重构 `Metronome` 组件**：适配全屏布局，添加拍号选择器

4. **界面布局优化**
   - 大号 BPM 显示（易于远距离查看）
   - 更大的视觉节拍指示器（适应多拍号）
   - 清晰的控件分组（BPM / 拍号 / 音量 / 播放控制）

### 技术细节

- **拍号实现**：
  - 4/4：4 拍，第 1 拍为强拍
  - 3/4：3 拍，第 1 拍为强拍
  - 6/8：6 拍，第 1、4 拍为强拍（或视为 2 大拍，每大拍 3 小拍）
  - 2/4：2 拍，第 1 拍为强拍

- **音量控制**：通过 GainNode 调整音效输出音量（不影响其他音频）

- **状态持久化**：扩展 localStorage 存储，包含 BPM、拍号、音量设置

## Impact

### Affected specs

- **修改 capability**: `metronome`（现有节拍器功能重构）

### Affected code

- **修改文件**：
  - `src/components/PlaybackControls.tsx` - 移除节拍器集成
  - `src/components/Metronome.tsx` - 重构为全屏布局 + 新增功能
  - `src/hooks/useMetronome.ts` - 添加拍号和音量支持

- **可能新增文件**：
  - `src/components/MetronomeDialog.tsx`（如果需要单独的对话框包装器）

- **修改文件**：
  - `src/app/page.tsx` - 添加节拍器触发按钮

### Breaking Changes

- **BREAKING**：现有的 `Metronome` 组件 API 将改变（添加拍号和音量参数）
- **BREAKING**：从 `PlaybackControls` 中移除节拍器（用户需要通过新的入口访问）

## Migration Path

用户行为变化：

- **之前**：在和弦播放控制区域直接看到节拍器
- **之后**：点击顶部"节拍器"按钮打开全屏界面

开发迁移：

1. 首先实现新的独立节拍器界面（向后兼容）
2. 确认新界面功能完整后，再移除 `PlaybackControls` 中的旧集成
3. 更新相关文档和用户引导

## Dependencies

- **Shadcn Sheet 组件**：用于抽屉式全屏界面（项目已安装）
- 无需新增外部依赖

## Future Enhancements

后续可扩展：

- 更多拍号（5/4、7/8、9/8、12/8 等复合拍子）
- 节拍器与和弦循环播放联动
- 重音模式自定义（用户自定义哪些拍为强拍）
- 细分节拍显示（8 分音符、16 分音符）
- 节拍器预设方案保存
